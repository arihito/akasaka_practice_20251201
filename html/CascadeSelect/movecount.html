<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>toggle select</title>
        <style>
            .block-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 12px;
                max-width: 420px;
                padding: 12px;
                border: 1px solid #ccc;
            }

            .block-grid li,
            .selected-item {
                height: 100px;
                border: 2px solid #333;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                font-weight: bold;
                background: #f9f9f9;
                position: relative;
            }

            .selected-item.selected {
                background: #007bff;
                color: #fff;
            }

            .plus-btn {
                position: absolute;
                right: 6px;
                bottom: 6px;
                width: 28px;
                height: 28px;
                border-radius: 50%;
                border: none;
                font-size: 18px;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        <ul id="source-list" class="block-grid">
            <li data-name="リンゴ">リンゴ</li>
            <li data-name="バナナ">バナナ</li>
            <li data-name="ブドウ">ブドウ</li>
            <li data-name="みかん">みかん</li>
        </ul>

        <ul id="selected-list" class="block-grid selected-area"></ul>
        <script>
            const source = document.getElementById("source-list");
            const selected = document.getElementById("selected-list");

            const MAX_GROUP = 3;
            const MAX_PAIR = 2;

            // 上 → 下
            source.addEventListener("click", (e) => {
                if (e.target.tagName !== "LI") return;

                if (selected.children.length >= MAX_GROUP) return;

                const name = e.target.dataset.name;

                const group = createSelectedItem(name);
                selected.appendChild(group);

                e.target.remove();
            });

            // 下エリア操作
            selected.addEventListener("click", (e) => {
                const item = e.target.closest(".selected-item");
                if (!item) return;

                // ＋ボタン
                if (e.target.classList.contains("plus-btn")) {
                    const count = item.dataset.count * 1;
                    if (count >= MAX_PAIR) return;

                    item.dataset.count = count + 1;
                    updateLabel(item);
                    updatePlus(item);
                    return;
                }

                // 本体クリック → 戻す
                const count = item.dataset.count * 1;
                const name = item.dataset.name;

                if (count > 1) {
                    item.dataset.count = count - 1;
                    updateLabel(item);
                    updatePlus(item);
                } else {
                    source.appendChild(createSourceItem(name));
                    item.remove();
                }
            });

            // ヘルパー
            function createSelectedItem(name) {
                const div = document.createElement("li");
                div.className = "selected-item selected";
                div.dataset.name = name;
                div.dataset.count = 1;
                updateLabel(div);
                updatePlus(div);
                return div;
            }

            function updateLabel(item) {
                item.textContent = `${item.dataset.name} × ${item.dataset.count}`;
            }

            function updatePlus(item) {
                item.querySelector(".plus-btn")?.remove();

                if (item.dataset.count < MAX_PAIR) {
                    const btn = document.createElement("button");
                    btn.textContent = "+";
                    btn.className = "plus-btn";
                    item.appendChild(btn);
                }
            }

            function createSourceItem(name) {
                const li = document.createElement("li");
                li.dataset.name = name;
                li.textContent = name;
                return li;
            }
        </script>
    </body>
</html>
